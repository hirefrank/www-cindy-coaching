---
import Layout from '../layouts/Layout.astro';
import ContactForm from '../components/ContactForm';
import CalButton from '../components/CalButton';
import { getGlobalSettings, getContactContent } from '../lib/cosmic';

// Fetch content from Cosmic
const globalSettings = await getGlobalSettings();
const contactData = await getContactContent();

// Extract global settings with fallbacks
const siteEmail = globalSettings?.metadata?.email || "cindy@mindfulbalanceadhdcoaching.com";
const siteLocation = globalSettings?.metadata?.location || "Bergen County, NJ";

// Extract contact content with fallbacks
const headline = contactData?.metadata?.headline || "Let's Connect";
const description = contactData?.metadata?.description || "Ready to explore how brain-body strategies can transform your approach to ADHD? I'd love to hear from you and discuss how I can support your journey.";
const officeHours = contactData?.metadata?.office_hours || "Monday - Friday: 9:00 AM - 5:00 PM\nEvening and weekend sessions available by appointment";

// Extract FAQ data with fallbacks
const faqHeader = contactData?.metadata?.faqs?.faq_header || "Frequently Asked Questions";
const faqDescription = contactData?.metadata?.faqs?.faq_description || "Quick answers to common questions about my services and approach.";
const faqs = contactData?.metadata?.faqs?.faq_content || [
  {
    question: "What makes your approach different?",
    answer: "My unique background as a physical therapist gives me deep insight into the brain-body connection. I combine traditional ADHD coaching with movement and sensory strategies, creating a more comprehensive approach to managing ADHD and executive function challenges."
  },
  {
    question: "Do you work with clients virtually or in-person?",
    answer: "I offer both virtual and in-person sessions to accommodate different preferences and locations. Virtual sessions allow me to work with clients beyond Bergen County, while in-person sessions can be beneficial for certain types of brain-body work."
  },
  {
    question: "How long does coaching typically last?",
    answer: "This varies greatly depending on individual goals and needs. Some clients work with me for a few months to address specific challenges, while others maintain ongoing coaching relationships for continued support and growth. We'll discuss your goals and create a plan that works for you."
  },
  {
    question: "Do you accept insurance?",
    answer: "As coaching is not a medical service, it's typically not covered by insurance. However, some flexible spending accounts (FSA) or health savings accounts (HSA) may cover coaching services. I can provide receipts for your records and potential reimbursement requests."
  }
];

// Extract calendar links with fallbacks
const calendarLinks = {
    consultation: globalSettings?.metadata?.calendar_links?.free_consultation || "cindy-romanzo/consultation",
    officeHours: globalSettings?.metadata?.calendar_links?.office_hours || "cindy-romanzo/office-hours"
};

// Helper function to extract cal.com slug from full URL
const getCalSlug = (url: string) => {
    if (url.includes('cal.com/')) {
        return url.split('cal.com/')[1];
    }
    return url;
};
---

<Layout title="Contact - Mindful Balance ADHD Coaching">
  <!-- Hero Section -->
  <section class="section-padding bg-gradient-to-b from-muted/30 to-background">
    <div class="max-w-4xl mx-auto container-padding text-center">
      <h1 class="mb-24">{headline}</h1>
      <p class="text-xl text-muted-foreground leading-relaxed">
        {description}
      </p>
    </div>
  </section>

  <!-- Contact Information & Forms -->
  <section class="py-48">
    <div class="max-w-6xl mx-auto container-padding">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-48">
        <!-- Contact Information -->
        <div>
          <h2 class="mb-32">Get in Touch</h2>
          
          <div class="space-y-32 mb-48">
            <div class="flex items-start space-x-16">
              <div class="w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0">
                <span class="text-primary font-bold">üìß</span>
              </div>
              <div>
                <h3 class="mb-8">Email</h3>
                <p class="text-muted-foreground">{siteEmail}</p>
              </div>
            </div>
            
            <div class="flex items-start space-x-16">
              <div class="w-12 h-12 bg-secondary/10 rounded-lg flex items-center justify-center flex-shrink-0">
                <span class="text-secondary font-bold">üìç</span>
              </div>
              <div>
                <h3 class="mb-8">Location</h3>
                <p class="text-muted-foreground">{siteLocation}</p>
              </div>
            </div>
            
            <div class="flex items-start space-x-16">
              <div class="w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0">
                <span class="text-primary font-bold">‚è∞</span>
              </div>
              <div>
                <h3 class="mb-8">Office Hours</h3>
                {officeHours.split('\n').map((line: string) => (
                  <p class="text-muted-foreground mb-8">{line}</p>
                ))}
              </div>
            </div>
          </div>
          
          <!-- Quick Scheduling -->
          <div class="bg-muted rounded-lg shadow-sm">
            <div class="p-32">
              <h3 class="mb-16">Quick Scheduling Options</h3>
              <p class="text-muted-foreground mb-24">
                Skip the form and schedule directly with me using the options below.
              </p>
              <div>
                <CalButton 
                  calLink={getCalSlug(calendarLinks.consultation)}
                  className="btn-primary w-full mb-16"
                  namespace="contact-consultation"
                  client:load
                >
                  Schedule Consultation
                </CalButton>
                <CalButton 
                  calLink={getCalSlug(calendarLinks.officeHours)}
                  className="btn-primary w-full"
                  namespace="contact-office-hours"
                  client:load
                >
                  Client Check-in
                </CalButton>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Contact Form -->
        <div>
          <ContactForm client:load />
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ Section -->
  <section class="py-48 bg-muted/30">
    <div class="max-w-4xl mx-auto container-padding">
      <div class="text-center mb-48">
        <h2 class="mb-24">{faqHeader}</h2>
        <p class="text-xl text-muted-foreground">
          {faqDescription}
        </p>
      </div>
      
      <div class="space-y-24">
        {faqs.map((faq: any) => (
          <div class="bg-card rounded-lg shadow-sm">
            <div class="p-32">
              <h3 class="mb-16">{faq.question}</h3>
              <p class="text-muted-foreground">
                {faq.answer}
              </p>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

</Layout>
